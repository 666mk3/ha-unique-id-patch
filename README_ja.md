# HA Unique ID Patch Addon (日本語)

このアドオンは、Home Assistantの `core.config_entries` に保存されている `Unique ID` を手動で書き換えるためのツールです。
主に、**ONVIFカメラなどでMACアドレスが重複してしまい、「既に設定されています」となって登録できない問題**を解決するために作成されました。

## なぜこれが必要なのですか？

一部のIPカメラ（ONVIF対応機）は、物理的なMACアドレスが異なっていても、ONVIFプロトコル経由で問い合わせると**全員同じMACアドレス（例: `00:30:1b:ba:02:db`）**を返してしまうファームウェアバグを持っています。
Home AssistantのONVIFインテグレーションはこの値をUnique IDとして使用するため、以下のような問題が起きます。

1.  **1台目**を登録（ID: `00...db` で登録される）。
2.  **2台目**を登録しようとすると、同じ `00...db` を名乗るため、HAが「1台目と同じデバイスだ」と誤認し、**「既に設定されています」として登録を新しいデバイスとしては認識しない**

このアドオンを使うと、**1台目のIDを手動で別名（例: `...db-1`）に変更**することができます。
これによりUnique IDの場所が空くため、2台目を登録できるようになります。
※HAの仕様上Unique IDがかぶると同一デバイスとして登録されてしまう。

## 機能

- **一覧表示**: 登録されているConfig Entryの一覧とIDを表示します。
- **手動編集**: Unique IDを任意の文字列に書き換えます。
- **Mac Addr同期**: Home Assistantが認識している「検出されたMACアドレス」に合わせてIDを修正します。
- **日本語/英語対応**: UIは日本語・英語に対応しています。

## 使い方

1.  **インストール**: アドオンをインストールし、起動してWeb UIを開きます。
2.  **対象を探す**: 重複問題が起きているデバイス（またはIDを変更したいデバイス）を探します。
3.  **IDを変更する**:
    - **重複回避の場合**: テキストボックスに、被らない文字列（末尾に `-1` をつける等）を入力し、「更新」を押します。
4.  **再起動**: 設定を反映させるため、Home Assistant Coreを再起動してください。

### ⚠️ 重要: 「Mac Addr同期」ボタンについて

このボタンは、Unique IDを「デバイス情報に表示されているMACアドレス」に強制的に合わせる機能です。
**状況によって使い分けてください：**

*   **✅ 推奨**: もしHome Assistantのデバイス情報画面で、そのカメラ(ONVIF)のMACアドレスが**正しく(MAC: `xx:xx:xx:xx:xx:xx`)表示されている場合**。
    *   このボタンを押すことで、IDを正しいMACアドレスに修正できるため、推奨されます。
*   **❌ 禁止**: もし対象のカメラが「他のカメラと同じMACアドレス(例 MAC: `00:30:1b:ba:02:db`）」を表示している場合。
    *   **このボタンは絶対に使わないでください。** IDまでもが重複してしまい、再びエラーになります。何かしらの手段を持って正しいMACアドレスを取得し
    手動編集を行ってください。

## インストール方法

1.  このリポジトリをAdd-on Storeのリポジトリに追加するか、`local`アドオンフォルダにコピーします。
2.  「HA Unique ID Patch」をインストールします。
3.  起動します。
4.  `/config` ディレクトリへのアクセス権限が必要です。

## 免責事項

このアドオンはHome Assistantの内部ファイル (`.storage/core.config_entries`) を直接書き換えます。
**使用前に必ずバックアップを取得してください。**
本アドオンの使用によるデータの破損等について、作者は一切の責任を負いません。
